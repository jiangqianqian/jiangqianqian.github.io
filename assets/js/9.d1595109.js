(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{206:function(a,t,n){"use strict";n.r(t);var e=n(28),s=Object(e.a)({},(function(){var a=this,t=a.$createElement,n=a._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[n("h1",{attrs:{id:"使用-html2canvas-对有百度地图的-dom-元素处理成图片"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用-html2canvas-对有百度地图的-dom-元素处理成图片"}},[a._v("#")]),a._v(" 使用 html2canvas 对有百度地图的 Dom 元素处理成图片")]),a._v(" "),n("p",[n("strong",[a._v("问题1")]),a._v("：百度地图应用的是瓦片式图片（地图是一张张图片拼出来的），html2canvas 处理时，遇到非同一域名下的图片，浏览器会显示跨域的报错，也无法用反向代理来解决，因为瓦片图片的域名不确定，无法指定 proxy_pass\n"),n("strong",[a._v("解决")]),a._v("：使用百度地图静态图处理（"),n("a",{attrs:{href:"http://lbsyun.baidu.com/index.php?title=static",target:"_blank",rel:"noopener noreferrer"}},[a._v("http://lbsyun.baidu.com/index.php?title=static"),n("OutboundLink")],1),a._v("），这时域名确定了（"),n("a",{attrs:{href:"http://api.map.baidu.com/",target:"_blank",rel:"noopener noreferrer"}},[a._v("http://api.map.baidu.com/"),n("OutboundLink")],1),a._v("），可以用反向代理来解决跨域")]),a._v(" "),n("div",{staticClass:"language-(js) extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("  \x3c!--html--\x3e\n  <el-image\n  :src=\"`/baidu-static/staticimage/v2?ak=yourak&width=1024&height=400&center=${center.lng},${center.lat}&zoom=16`\"\n>\n  <div\n    slot=\"placeholder\"\n    class=\"image-slot\"\n  >\n    加载中<span class=\"dot\">...</span>\n  </div>\n  </el-image>\n\n  \x3c!--nginx--\x3e\n  location ^~ /baidu-static/ {\n  add_header 'Access-Control-Allow-Origin' \"$http_origin\" always;\n  add_header 'Access-Control-Allow-Credentials' 'true' always;\n  add_header 'Access-Control-Allow-Methods' 'GET, OPTIONS' always;\n  add_header 'Access-Control-Allow-Headers' 'Accept,Authorization,Cache-Control,Content-Type,DNT,If-Modified-\n  Since,Keep-Alive,Origin,User-Agent,X-Requested-With' always;\n  proxy_pass http://api.map.baidu.com/;\n  }\n")])])]),n("p",[n("strong",[a._v("问题2")]),a._v("：地图上的覆盖物怎么显示出来呢\n"),n("strong",[a._v("解决")]),a._v("：看了下百度地图静态图的 api, 不能很好的支持覆盖物自定义样式，最多可以让你指定一张自定义的图片（不能是本地图片）。中间试过很多办法，觉得可行的是使用 openLayers.Map, 可是代码改动的工作量太大了，果断放弃了。再后来想到自己用 div 直接模拟好覆盖物，设置比静态图层级高一点就可以解决了。")]),a._v(" "),n("p",[n("strong",[a._v("问题3")]),a._v("：用 css 样式画了一个虚线圆，在 html2canvas 处理后的生成的图，发现虚线变成了实线\n"),n("strong",[a._v("解决")]),a._v("：使用 canvas 来画圆")]),a._v(" "),n("p",[n("strong",[a._v("问题4")]),a._v("：一个 icon 采用绝对定位，在 html2canvas 处理后的生成的图，发现 icon 没有显示\n"),n("strong",[a._v("解决")]),a._v("：给 icon 设置 z-index 大于百度静态图层级（PS: 静态图的样式也用了绝对定位的情况下）")]),a._v(" "),n("p",[n("strong",[a._v("问题5")]),a._v("：在 html2canvas 处理后生成的图片，有黑色背景色\n"),n("strong",[a._v("解决")]),a._v("： image/png 改成 image/jpg")]),a._v(" "),n("div",{staticClass:"language-(js) extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("try {\n  html2canvas(sharePage, {\n    useCORS: true\n  }).then((canvas) => {\n    const imgBase64 = canvas.toDataURL('image/jpg')\n    this.data64 = imgBase64\n    })\n  } catch (err) {\n}\n")])])])])}),[],!1,null,null,null);t.default=s.exports}}]);